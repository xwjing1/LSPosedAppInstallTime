# LSPosed 模块编译完整指南

## 模块信息

- **目标应用**: 悟空浏览器 (com.cat.readall)
- **目标时间**: 2026-01-01 00:00:00 UTC
- **时间戳**: 1767225600000

## 方法一：使用 Android Studio（推荐）

### 步骤1：安装 Android Studio

1. 下载 Android Studio：https://developer.android.com/studio
2. 安装（选择 Standard 安装，会自动安装 JDK、Android SDK、Gradle）

### 步骤2：打开项目

1. 启动 Android Studio
2. 选择 "Open" 或 "File" -> "Open"
3. 选择 `LSPosedAppInstallTime` 文件夹
4. 等待 Gradle 同步完成（首次可能需要几分钟）

### 步骤3：配置 SDK（如果需要）

如果提示找不到 SDK：
1. File -> Project Structure
2. 设置 Android SDK 路径
3. 或让 Android Studio 自动下载

### 步骤4：编译 APK

1. 点击菜单 "Build" -> "Build Bundle(s) / APK(s)" -> "Build APK(s)"
2. 等待编译完成
3. 编译完成后会显示通知，点击 "locate" 查看 APK
4. APK 位置：`app/build/outputs/apk/debug/app-debug.apk`

### 步骤5：安装 APK

将 `app-debug.apk` 传输到 Android 设备并安装。

## 方法二：使用命令行（需要先安装工具）

### 前置要求

- Java JDK 17 或更高版本
- Android SDK
- Gradle（或使用 Gradle Wrapper）

### 编译步骤

```bash
cd LSPosedAppInstallTime

# 使用 Gradle Wrapper 编译
./gradlew assembleDebug

# Windows:
gradlew.bat assembleDebug
```

编译完成后，APK 在：`app/build/outputs/apk/debug/app-debug.apk`

## 方法三：使用 GitHub Actions（在线编译）

1. 将项目上传到 GitHub
2. 创建 GitHub Actions workflow
3. 自动编译并下载 APK

## 安装和配置

### 步骤1：安装 LSPosed 框架

1. 在 Magisk Manager 中搜索并安装 "LSPosed"
2. 重启设备
3. 安装 LSPosed Manager 应用

### 步骤2：安装模块 APK

1. 安装编译好的 `app-debug.apk`
2. 打开 LSPosed Manager
3. 在"模块"列表中找到 "AppInstallTimeMod"
4. **启用模块**
5. **点击模块名称**，进入作用域选择
6. **选择 "系统框架" (android)** ← 重要！
7. 重启设备

### 步骤3：验证

```bash
adb shell "dumpsys package com.cat.readall | grep -i firstinstall"
```

应该显示：`firstInstallTime=2026-01-01 00:00:00` 或时间戳 `1767225600000`

## 查看日志

```bash
adb logcat | grep AppInstallTimeMod
```

应该看到类似输出：
```
I/AppInstallTimeMod: AppInstallTimeMod 模块已加载
I/AppInstallTimeMod: 目标应用: com.cat.readall
I/AppInstallTimeMod: ✓ 修改安装时间: com.cat.readall
```

## 常见问题

### Q: 编译时提示找不到依赖？

A: 
1. 检查网络连接
2. 在 Android Studio 中：File -> Sync Project with Gradle Files
3. 或运行：`./gradlew --refresh-dependencies`

### Q: 编译时提示 SDK 版本不兼容？

A: 
1. 更新 Android Studio
2. 或修改 `app/build.gradle` 中的 `compileSdk` 版本

### Q: 模块不生效？

A: 
1. 确认 LSPosed 框架已安装并启用
2. 确认在 LSPosed Manager 中已启用模块
3. 确认已选择作用域（系统框架）
4. 确认已重启设备
5. 查看日志：`adb logcat | grep AppInstallTimeMod`

### Q: Hook 失败？

A: 
不同 Android 版本的 PackageManagerService 可能不同，如果 Hook 失败，查看日志了解具体错误。

## 项目结构

```
LSPosedAppInstallTime/
├── app/
│   ├── src/
│   │   └── main/
│   │       ├── AndroidManifest.xml
│   │       └── java/
│   │           └── com/
│   │               └── example/
│   │                   └── appinstalltime/
│   │                       └── MainHook.java
│   └── build.gradle
├── build.gradle
├── settings.gradle
├── gradle.properties
└── gradle/
    └── wrapper/
        └── gradle-wrapper.properties
```

## 技术说明

- **Hook 目标**: `PackageManagerService.getPackageInfo()` 方法
- **修改字段**: `PackageInfo.firstInstallTime`
- **作用域**: 系统框架 (android)
- **配置方式**: 代码中写死，无需配置文件

## 优势

✅ **不需要修改系统文件** - 运行时动态修改  
✅ **更安全** - 不会损坏系统文件  
✅ **易于调试** - 可以查看日志  
✅ **针对特定应用** - 只修改目标应用
